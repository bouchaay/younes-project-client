<section class="users-management">
    <div class="container">
        <h2>üë• Gestion des utilisateurs</h2>

        <!-- üìå Gestion des Clients -->
        <h3>üë§ Clients</h3>

        <!-- Filtres Clients -->
        <div class="filters">
            <label for="clientStatusFilter">Filtrer par statut :</label>
            <select id="clientStatusFilter" [(ngModel)]="clientStatusFilter">
                <option value="all">Tous</option>
                <option value="actif">Actif</option>
                <option value="bloqu√©">Bloqu√©</option>
            </select>

            <label for="clientSortBy">Trier par :</label>
            <select id="clientSortBy" [(ngModel)]="clientSortBy">
                <option value="date">Date de cr√©ation</option>
                <option value="appointments">Rendez-vous termin√©s</option>
            </select>
        </div>

        <!-- Tableau Clients -->
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>T√©l√©phone</th>
                    <th>Statut</th>
                    <th>Date de cr√©ation</th>
                    <th>RDV termin√©s</th>
                    <th>RDV annul√©s</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (paginatedClients.length === 0) {
                <tr>
                    <td colspan="9" class="no-data">Aucun client trouv√©.</td>
                </tr>
                } @else {
                @for (user of paginatedClients; track user.id) {
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <td>
                        @if (editingUserId === user.id) {
                        <select [(ngModel)]="editedStatus">
                            <option value="actif">Actif</option>
                            <option value="bloqu√©">Bloqu√©</option>
                        </select>
                        } @else {
                        {{ user.status | titlecase}}
                        }
                    </td>
                    <td>{{ user.createdAt | date: 'dd/MM/yyyy' }}</td>
                    <td>{{ user.completedAppointments }}</td>
                    <td>{{ user.canceledAppointments }}</td>
                    <td>
                        <div class="actions">
                            @if (editingUserId === user.id) {
                            <button class="save-btn" (click)="saveUserStatus(user)">
                                üíæ
                            </button>
                            <button class="cancel-btn" (click)="cancelEdit()">
                                ‚ùå
                            </button>
                            } @else {
                            <button class="edit-btn" (click)="editUser(user)">
                                ‚öô
                            </button>
                            <button class="edit-btn" (click)="togglePasswordEdit(user)">
                                üîë
                            </button>
                            <button class="delete-btn" (click)="deleteUser(user.id)">
                                üóë
                            </button>
                            }

                            <!-- üìå Affichage du formulaire de changement de mot de passe -->
                            @if (editingPasswordUserId === user.id) {
                            <div class="password-edit-form">
                                <input type="text" [(ngModel)]="newPassword[user.id]"
                                    placeholder="Nouveau mot de passe">
                                <input type="password" [(ngModel)]="confirmPassword[user.id]" placeholder="Confirmer">
                                <button class="save-btn" (click)="changePassword(user)">üíæ</button>
                                <button class="cancel-btn" (click)="cancelPasswordEdit()">‚ùå</button>
                            </div>
                            }
                        </div>
                    </td>

                </tr>
                }
                }
            </tbody>
        </table>

        <!-- Pagination Clients -->
        <div class="pagination">
            <button (click)="prevPage('client')" [disabled]="clientPage === 0">‚¨Ö Pr√©c√©dent</button>
            <span>Page {{ clientPage + 1 }} / {{ totalClientPages }}</span>
            <button (click)="nextPage('client')"
                [disabled]="(clientPage + 1) * itemsPerPage >= filteredClients.length">Suivant ‚û°</button>
        </div>

        <!-- Bouton Ajouter un employ√© -->
        <button class="add-user-btn" (click)="openAddClientModal()">‚ûï Ajouter un client</button>

        <!-- Modale pour ajouter un employ√© -->
        @if (showAddClientModal) {
        <div class="modal-overlay">
            <div class="modal-content">
                <h3>üõ† Ajouter un client</h3>
                <form (ngSubmit)="addClient()">
                    <label>Nom :</label>
                    <input type="text" [(ngModel)]="newClient.name" name="name" required>

                    <label>Email :</label>
                    <input type="email" [(ngModel)]="newClient.email" name="email" required>

                    <label>T√©l√©phone :</label>
                    <input type="text" [(ngModel)]="newClient.phone" name="phone" required>

                    <label>Mot de passe Temporaire :</label>
                    <input type="password" [(ngModel)]="newClient.password" name="password" required>

                    <label>Statut :</label>
                    <select [(ngModel)]="newClient.status" name="status">
                        <option value="actif">Actif</option>
                        <option value="inactif">Inactif</option>
                        <option value="bloqu√©">Bloqu√©</option>
                    </select>

                    <div class="modal-actions">
                        <button type="submit">Ajouter</button>
                        <button type="button" class="cancel-btn" (click)="closeAddClientModal()">Annuler</button>
                    </div>
                </form>
            </div>
        </div>
        }

        <br>
        <br>

        <!-- üõ† Gestion des Employ√©s -->
        <h3>üõ† Employ√©s</h3>

        <!-- Filtres Employ√©s -->
        <div class="filters">
            <label for="employeeStatusFilter">Filtrer par statut :</label>
            <select id="employeeStatusFilter" [(ngModel)]="employeeStatusFilter">
                <option value="all">Tous</option>
                <option value="actif">Actif</option>
                <option value="inactif">Inactif</option>
                <option value="en cong√©">En ong√©</option>
            </select>

            <label for="employeeSortBy">Trier par :</label>
            <select id="employeeSortBy" [(ngModel)]="employeeSortBy">
                <option value="date">Date de cr√©ation</option>
                <option value="appointments">Rendez-vous termin√©s</option>
            </select>
        </div>

        <!-- Tableau Employ√©s -->
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>T√©l√©phone</th>
                    <th>Statut</th>
                    <th>Date de cr√©ation</th>
                    <th>RDV termin√©s</th>
                    <th>RDV annul√©s</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (paginatedEmployees.length === 0) {
                <tr>
                    <td colspan="9" class="no-data">Aucun employ√© trouv√©.</td>
                </tr>
                } @else {
                @for (user of paginatedEmployees; track user.id) {
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <td>
                        @if (editingUserId === user.id) {
                        <select [(ngModel)]="editedStatus">
                            <option value="actif">Actif</option>
                            <option value="inactif">Inactif</option>
                            <option value="en cong√©">En Cong√©</option>
                        </select>
                        } @else {
                        {{ user.status | titlecase}}
                        }
                    </td>
                    <td>{{ user.createdAt | date: 'dd/MM/yyyy' }}</td>
                    <td>{{ user.completedAppointments }}</td>
                    <td>{{ user.canceledAppointments }}</td>
                    <td>
                        <div class="actions">
                            @if (editingUserId === user.id) {
                            <button class="save-btn" (click)="saveUserStatus(user)">
                                üíæ
                            </button>
                            <button class="cancel-btn" (click)="cancelEdit()">
                                ‚ùå
                            </button>
                            } @else {
                            <button class="edit-btn" (click)="editUser(user)">
                                ‚öô
                            </button>
                            <button class="edit-btn" (click)="togglePasswordEdit(user)">
                                üîë
                            </button>
                            <button class="delete-btn" (click)="deleteUser(user.id)">
                                üóë
                            </button>
                            }

                            <!-- üìå Affichage du formulaire de changement de mot de passe -->
                            @if (editingPasswordUserId === user.id) {
                            <div class="password-edit-form">
                                <input type="text" [(ngModel)]="newPassword[user.id]"
                                    placeholder="Nouveau mot de passe">
                                <input type="password" [(ngModel)]="confirmPassword[user.id]" placeholder="Confirmer">
                                <button class="save-btn" (click)="changePassword(user)">üíæ</button>
                                <button class="cancel-btn" (click)="cancelPasswordEdit()">‚ùå</button>
                            </div>
                            }
                        </div>
                    </td>


                </tr>
                }
                }
            </tbody>
        </table>

        <!-- Pagination Employ√©s -->
        <div class="pagination">
            <button (click)="prevPage('employee')" [disabled]="employeePage === 0">‚¨Ö Pr√©c√©dent</button>
            <span>Page {{ employeePage + 1 }} / {{ totalEmployeePages }}</span>
            <button (click)="nextPage('employee')"
                [disabled]="(employeePage + 1) * itemsPerPage >= filteredEmployees.length">Suivant ‚û°</button>
        </div>

        <!-- Bouton Ajouter un employ√© -->
        <button class="add-user-btn" (click)="openAddEmployeeModal()">‚ûï Ajouter un employ√©</button>

        <!-- Modale pour ajouter un employ√© -->
        @if (showAddEmployeeModal) {
        <div class="modal-overlay">
            <div class="modal-content">
                <h3>üõ† Ajouter un employ√©</h3>
                <form (ngSubmit)="addEmployee()">
                    <label>Nom :</label>
                    <input type="text" [(ngModel)]="newEmployee.name" name="name" required>

                    <label>Email :</label>
                    <input type="email" [(ngModel)]="newEmployee.email" name="email" required>

                    <label>T√©l√©phone :</label>
                    <input type="text" [(ngModel)]="newEmployee.phone" name="phone" required>

                    <label>Mot de passe Temporaire :</label>
                    <input type="password" [(ngModel)]="newEmployee.password" name="password" required>

                    <label>Statut :</label>
                    <select [(ngModel)]="newEmployee.status" name="status">
                        <option value="actif">Actif</option>
                        <option value="inactif">Inactif</option>
                        <option value="en cong√©">En Cong√©</option>
                    </select>

                    <div class="modal-actions">
                        <button type="submit">Ajouter</button>
                        <button type="button" class="cancel-btn" (click)="closeAddEmployeeModal()">Annuler</button>
                    </div>
                </form>
            </div>
        </div>
        }


    </div>
</section>